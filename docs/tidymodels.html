<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Accessing and Using Historical Newspaper Data - 13&nbsp; Machine Learning with Tidymodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./text-reuse.html" rel="next">
<link href="./word2vec.html" rel="prev">
<script src="site_libs/cookie-consent/cookie-consent.js"></script>
<link href="site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-T40JTMJT16"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-T40JTMJT16', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./methods.html">Methods</a></li><li class="breadcrumb-item"><a href="./tidymodels.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Machine Learning with Tidymodels</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Accessing and Using Historical Newspaper Data</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./news-sources-uk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Accessing Newspaper Data in the UK</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./news-sources-int.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Accessing Newspaper Data Internationally</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ocr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">History of the British Library Collection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mets-alto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with METS/ALTO</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./using-r-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Using R and the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./map-title-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Working with Metadata: Mapping the British Library Newspaper Collection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download-and-unzip.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Accessing Newspaper Data from the Shared Research Repository</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extract-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Make a Text Corpus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./term-freq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">N-gram Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./topic-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Topic Modelling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./word2vec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Word Embeddings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidymodels.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Machine Learning with Tidymodels</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-reuse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Text Reuse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./further-reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Final Thoughts</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./final-thoughts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Final Thoughts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link active" data-scroll-target="#machine-learning">Machine Learning</a></li>
  <li><a href="#the-tidymodels-package" id="toc-the-tidymodels-package" class="nav-link" data-scroll-target="#the-tidymodels-package">The Tidymodels Package</a>
  <ul class="collapse">
  <li><a href="#basic-steps" id="toc-basic-steps" class="nav-link" data-scroll-target="#basic-steps">Basic Steps</a></li>
  </ul></li>
  <li><a href="#installload-the-packages" id="toc-installload-the-packages" class="nav-link" data-scroll-target="#installload-the-packages">Install/load the packages</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#set-up-the-machine-learning-model" id="toc-set-up-the-machine-learning-model" class="nav-link" data-scroll-target="#set-up-the-machine-learning-model">Set up the Machine Learning Model</a></li>
  <li><a href="#create-recipe-for-text-data" id="toc-create-recipe-for-text-data" class="nav-link" data-scroll-target="#create-recipe-for-text-data">Create Recipe for Text Data</a></li>
  <li><a href="#perform-cross-validation" id="toc-perform-cross-validation" class="nav-link" data-scroll-target="#perform-cross-validation">Perform Cross-Validation</a></li>
  <li><a href="#train-the-random-forest-model-with-cross-validation" id="toc-train-the-random-forest-model-with-cross-validation" class="nav-link" data-scroll-target="#train-the-random-forest-model-with-cross-validation">Train the Random Forest Model with Cross-Validation</a></li>
  <li><a href="#evaluate-the-models-performance" id="toc-evaluate-the-models-performance" class="nav-link" data-scroll-target="#evaluate-the-models-performance">Evaluate the Model’s Performance</a></li>
  <li><a href="#visualize-the-confusion-matrix" id="toc-visualize-the-confusion-matrix" class="nav-link" data-scroll-target="#visualize-the-confusion-matrix">Visualize the Confusion Matrix</a></li>
  <li><a href="#tune-the-random-forest-model" id="toc-tune-the-random-forest-model" class="nav-link" data-scroll-target="#tune-the-random-forest-model">Tune the Random Forest Model</a></li>
  <li><a href="#tune-the-random-forest-model-with-cross-validation" id="toc-tune-the-random-forest-model-with-cross-validation" class="nav-link" data-scroll-target="#tune-the-random-forest-model-with-cross-validation">Tune the Random Forest Model with Cross-Validation</a></li>
  <li><a href="#visualize-the-tuning-results" id="toc-visualize-the-tuning-results" class="nav-link" data-scroll-target="#visualize-the-tuning-results">Visualize the Tuning Results</a></li>
  <li><a href="#build-the-final-random-forest-model" id="toc-build-the-final-random-forest-model" class="nav-link" data-scroll-target="#build-the-final-random-forest-model">Build the Final Random Forest Model</a></li>
  <li><a href="#what-features-is-the-model-using" id="toc-what-features-is-the-model-using" class="nav-link" data-scroll-target="#what-features-is-the-model-using">What features is the model using?</a></li>
  <li><a href="#using-the-model" id="toc-using-the-model" class="nav-link" data-scroll-target="#using-the-model">Using the Model</a></li>
  <li><a href="#make-predictions-on-newspaper-articles" id="toc-make-predictions-on-newspaper-articles" class="nav-link" data-scroll-target="#make-predictions-on-newspaper-articles">Make Predictions on Newspaper Articles</a></li>
  <li><a href="#analyze-the-top-words-in-advertisements" id="toc-analyze-the-top-words-in-advertisements" class="nav-link" data-scroll-target="#analyze-the-top-words-in-advertisements">Analyze the Top Words in Advertisements</a></li>
  <li><a href="#analyze-the-proportion-of-advertisements-in-each-newspaper-issue" id="toc-analyze-the-proportion-of-advertisements-in-each-newspaper-issue" class="nav-link" data-scroll-target="#analyze-the-proportion-of-advertisements-in-each-newspaper-issue">Analyze the Proportion of Advertisements in Each Newspaper Issue</a></li>
  <li><a href="#recommended-reading" id="toc-recommended-reading" class="nav-link" data-scroll-target="#recommended-reading">Recommended Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-tidymodels" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Machine Learning with Tidymodels</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This chapter looks at machine learning using historical newspapers and the ‘tidymodels’ framework. We’ll build a classifier which learns, from some pre-labelled examples, to differentiate between advertisements and news articles. We’ll evaluate the model, and fine-tune its parameters. This chapter is heavily indebted to existing tidymodels tutorials on the web, such as the one from <a href="https://smltar.com/mlclassification.html">Supervised Machine Learning in R</a> by Emil Hvitfeldt and Julia Silge.</p>
<section id="machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning">Machine Learning</h2>
<p>Machine learning is the name for a group of techniques which take input data of some kind, and learn how to achieve some particular goal. The ‘deep learning’ used by neural networks and in particular things like ChatGPT are one type, but the field has been around for much longer than that.</p>
<p>Machine learning itself can be divided into subsets: Machine learning done with neural networks, and what we might call ‘classical’ machine learning, which use algorithms.</p>
<p>A very simple form of machine learning is <em>linear regression</em>. Linear regression attempts to find the best fitting line through a dataset. Take this dataset of the flipper size and body mass of a group of observed penguins (from the R package <code>palmerpenguins</code>:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>By visually inspecting this, we can guess that there is a statistical relationship between the length and mass: as one value gets higher, the other does too. We can use <code>geom_smooth()</code> and a linear model to predict the best line of fit through this dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If we measured the slope of this line (using simple geometry), its angle would tell us about the relationship between the two values.In this way, our model helps us to understand some underlying pattern in the dataset - that these two values are highly correlated. We could also use it to <em>predict</em> new values: if given the body mass for a new penguin, by using this line, we could predict its most likely flipper length, and in most cases be fairly accurate.</p>
<p>This is a form of simple machine learning. We give an algorithm (here, linear regression) a bunch of input data, in this case the body mass and bill flipper length for a group of penguins, and it provides a model (in this case, a line with a certain slope), which hopefully helps us to explain the existing data and predict unknown parts. Models like this try in some way to minimise a loss function. In this case, finding the line where the error for each point (how far away it is from the line) is as small as possible.</p>
<p>The machine learning here will use basically the same principle. We’ll give it data (text, in the form of a mathematical representation of the text, and its assigned category), and an algorithm (in this case, a ‘Random Forest’ model), and use that to predict the category of unseen texts. The model itself may also tell us something about the existing data.</p>
<p>Much of the AI work at the cutting edge of text analysis today uses neural networks, and in particular the ‘transformer’ mechanism which allows neural networks to better understand context and word order. But this kind of machine learning still has a very important role to play, it’s well-established, relatively easy to run, and the results can be quite good depending on the problem. It is also a good way to get started with understanding the Tidymodels framework.</p>
</section>
<section id="the-tidymodels-package" class="level2">
<h2 class="anchored" data-anchor-id="the-tidymodels-package">The Tidymodels Package</h2>
<p>Tidymodels is an R ‘meta-package’ which allows you to interact with lots of different machine learning packages and engines in a consistent way. Using tidymodels, we can easily compare multiple models together and we can swap in one for another without having to re-do code. We also can make sure that our pre-processing steps are precisely consistent across any number of different models.</p>
<p>Machine learning can be used for a number of different tasks. One key one is text classification.</p>
<p>In this tutorial, we will use tidymodels to classify text into articles and advertisements. It could easily be generalised to any number of categories, for example foreign news, court reporting, and so forth. You can provide your own spreadsheet of training data (as we’ll use below), and as long as it is in the same format and has similar information, you should be able to build your own classifier.</p>
<p>Once we have built the model, we will fine-tune it. The random forest algorithm we’ll use, like most machine learning algorithms, has a group of parameters which can be adjusted. To find the best values for these, we’ll evaluate the same data using many different combinations of parameters, and pick the best one. Using tidymodels, this can all be done consistently. We could even swap out any other model type, and otherwise reuse the exact same workflow.</p>
<p>Finally, we’ll put the model to some use: we’ll use the model to predict the class of the rest of the articles in the newspaper dataset, and do some analysis on this.</p>
<p>The model is only as good as the training data, and in this case, we don’t have many examples, and it won’t be terribly accurate in many cases. But it will show how a machine learning model can be operationalised for this task.</p>
<section id="basic-steps" class="level3">
<h3 class="anchored" data-anchor-id="basic-steps">Basic Steps</h3>
<p>In this chapter we’ll create a model which can label newspaper as either articles or advertisements. We’ll do some further steps to explore improving the model, and also to look at the most important ‘features’ used by the model to do its predicting. The steps are:</p>
<ol type="1">
<li><p>Download a labelled dataset, containing examples of our two classes (articles and advertisements).</p></li>
<li><p>Create a ‘recipe’ which is a series of pre-processing steps. This same recipe can be reused in different contexts and for different models.</p></li>
<li><p>Split the labelled data into testing and training sets. The training data is used to fit the best model. The test set is used at the end, to see how well it performs on unseen data.</p></li>
<li><p>Run an initial classifier and evaluate the results</p></li>
<li><p>‘Tune’ the model, by re–running the classifier with different parameters, selecting the best one.</p></li>
<li><p>Run the ‘best’ model over the full news dataset, predicting whether or not an articles is news or an advertisement.</p></li>
</ol>
</section>
</section>
<section id="installload-the-packages" class="level2">
<h2 class="anchored" data-anchor-id="installload-the-packages">Install/load the packages</h2>
<p>As a first step, you’ll need to load the necessary packages for this tutorial. If you haven’t already done so, you can install them first using the below.</p>
<p>If you have installed them, make sure you update to the latest version, as they can change rapidly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tidyverse'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tidymodels'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'textrecipes'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tidytext'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'ranger'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'vip'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import data</h2>
<p>As a first step, load some pre-labelled data. This contains a number of newspaper articles, and their ‘type’: whether it is an advertisement or an article.</p>
<p>If we take a look at the dataframe once it is loaded, you’ll see it’s quite simple structure: it’s got a ‘filename’ column, the full text of the article store in ‘text’, and the type stored in a column called ‘type’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>advertisements_labelled <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">'advertisements_labelled.csv'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>advertisements_labelled <span class="ot">=</span> advertisements_labelled <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(text))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>advertisements_labelled <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> kableExtra<span class="sc">::</span><span class="fu">kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">filename</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">art</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">text</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">issue_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">newspapers//0002194/1855/0328/0002194_18550328.csv</td>
<td style="text-align: right;">107</td>
<td style="text-align: left;">4 ,;,-A4J - BriTtr EMIT MO NT BLANC aci t s WILT, at 8 o'clock, apd Every 111,, , 1it . (but - SaturdaY)- k e Area, 23.; GaTlcry, ls.. The. 31ornnil ite‘orese , n , ta_t , t , ons 'facsttly, ThunAlay. and Satardkr, at 3-1) • 'Y u-04101 , OF LONDON. (By Royal uarte.r., .L,: --Prizeholder s select -!•cr thefreo.lre3 from the publte Gi apy Subscriber f GUINEA will hif , l3:o, IiEEVES the .11;,„` , 1 ze, cat Impresslon of a Plate of Yr ATER , 1 it of A.E.A:, after J. J. Chalon, R.A., aA a. Quarto Lr,rll.llrly Illustrations of Byron's Childe Harold.' The kb! 2d ,Y for delivery anl 1.11,3 volume may be rem at the 4cription closes 1 durd ay next, 31st instant. GEORGE Iknorary LEWIS POCOCK, $ Secretaries. trancl, March. -SYLUM LIFE ASSURANCE OFFICE, 12, CONNII(LC , London. • R . F'statili:hed 1824. , and Dlveased Lives. at Home and Abroad, for And Naval Employments.. The only Office on purely 'l:eld„ rj , th ' , il . , les, involving, therefore, no Partnership among .for prospectases, prapwal paper?, ap•)ly to - MANLEY DOPKI Hesldent Director. GUILDHALL, Ms.acn `i7, 1855. L Av ' O II.IMITTRE for LETTING the CITY'S 40,.'2 1) ftv,111 met at Guildhall, on Wes,inesday. the 4:h April Celock precisely, to 3 eceive Proposals for Leases of a 411'.; + . 12, Wood•street, Cheapside ; Two E0r..?0, No. 18 and ; Rouse, No, 9, F , outh.place ; a Iloive, No. 22, a House, No. 59, Great Leonard-street ; and a ood-street, Finsbury. al;articulari and Pla , s may he seen, and Forms of Tender the .Architect's Oftlee, Guildhall. FERDINAND BRAND, Comptroller. t R kNii IfIIECTORS of the ROYAL' BRITISH 1t of Prepared to receive, Appeal - ions for their New ofeelt, tinder the provislons of their 'upplement9l la st;ranted by the Crown. A pplica)loll3 to be made, with- (lead (lace, No. 16, Tokenhouse-yard, or at tho kran‘4,77, '. road, Lambeth ; 97, Ges:vrtll-road, miftesbury-terrace, Victoria-street. Pimlico; 60, &amp;amp;okthvrark ; and 32, Regent-circus, riccatlilly. IliJOti INNES -CAMEION, Ceaeral Manager. ,T IONAL PROVINCIAL BANK of ENGLAND. 11?., Tlishopsgate-street, London, Yard). 27, 1855. t e itim ,- s t o i f u the Natiosnal Pros incial Walk of F,nglan hereby constquence of the death of Almon 11111, Esq., ) /elnent of 81r John N. It. Campbell, K.C.11 , there wit' geANCIF:S in the Dire .tion to be filled np a' the 2 ,NiAtA.L MEETING of the Society to 1Y he:cl on n 7 Of nay next, and that every shareholder intend ug to 0 a ) Propm a carrldate ate for the €ffice of Director must i, 7 4 a 3 8 from the id by hereof signify some writing under o nd. to be left at the office of the Society in the City of ~ invention to become a candidate, or the name I Q :: the mode of the candidate interaled to be proposed by L3' ot9gr.of the Crurt ef Dime-tors. DAN. ROBEItI EON, Agent and Manager. Li•olrizter is eligible to be elected Director w ho has not q~t!titter ol at least twenty 1001. shares or one hundred 201. sa g esleniar months ; ,r to pr , :pose a cand'date unless a °fat least ten 1001. shares or fifty 201. slvms. F E ARDIAN F RE AND Li C--)2:11P4/ir, ASSURNICOE No, 11, I4m-ibarcl .-street, London. :TOES. MAT, Bart., Chairman. Esq., Deputy-Chainnan. Atewart Marjoribanks, Esq. John ‘iartin, Esq., J.P. P' Rowland Mitchel!, Esq. James - Morris, Esq. ' Henry Norman, .E• 4. henry R. Reynolds, jun., Esq. John Thornton, Esq. James Tuiloch. Esq. Henry Vigne, Esq. DILE_ q „,. ALTER B. FARQU ANCIS BART DYKE, 1 11; P r liaise Berens Esq. NI on, T. Farquhar, Bart. '5l l - jun. Esq., P Haney, 4%, 0 :' Hubbard, Esq. 1 ,5 V 4 11nstone, Esq. .111 4 41 Jouclu-re, Esq. Esq. ,47 AUDITORS. 4i t ti .obarts, Esq. . I Henry Sykes Thornton, Esq. LlO 3l, jun., Esq. John . Henry Smith, Esq. 11 ) George Keys, Esq., Secretary. Brown, Esq., Actuary. 01, ENT.—Under the provision suers an Apt of Par- tt'lB Company now offers to future ins Four-fifths of h t p gith Quinquennial Division, or a Low Rate of Premium iltl t ..; E clllaton of Profits. (‘4 l 4 l t, lat i' l L division of Profits will be declared in June, 1855, when t t t r ; i 4ti ng Policies which shall subsisted at least cue year 1554, will be allowed to share In the Profits. 6,veral past divisions of Profits mle by this Comp , any, the Bonuses added to the Po a licies from One-aalf the n'unted, on an average of the different ages , to about One ilqit•tber Annum on the sums insured, and the total Bonuses 111ti, 11 ' s ,rour Septennial Divisions exceeded 770,000/. RISKS,—The Extra Premiums required for the East the British Colonies, and the northern parts of tire irki t 'es of America, have been materially reduced. t i leph` l) , LIVES.---Persons who are not in such sound health as them to insure their Lives at the Tabular Premiums, y 46 their Lives insured at Extra Premiums. 11 1 1pn'anted on Life Policies to the extent of their values, pro- relicies shall have been effected a..sufficient time to have iii'll4ltach case a value not under 50 /. i t tliik, l l •lTS OF POLICIES.—Written Notices of, received 1 4 141 feel. paid by the Company, and no charge will be made for 014,4 1 hereby given, that Fire Policies which expire at Lady- it43,,, Et rSt.ew j ened within's-s fifteen days at this office, or with Mr. • I ,amestref - t, corner of Pall-mall ; or with the ‘ - Agents throughout the Kingdom, otherwise they become C4 used by Explosion of Gas are admitted by this Company. AGNETIC TELEGRAPH. ` LONDON OFFICES •t. _ t. Old Broad-street (six doors from the Royal Evehange.) O kt B est End-7, Charing-cross (opposite the statue.) r, 4 4 0f ; - ',l sll lTriunicatlon by underground wires with the principa ZT., , , I Lie Kingdom. ~ ,,t( ) L..for Twenty igords, including delivery, and address not , • i ,,T 1 , 4 11 e) ° , Of f ice, 2 Exchange-buildings - • • • • • • • ..... 8 1 it, later, ~ Exchange-arcade ..... . • ..... .. • , • itlin,,,!, „ 22, English-street N ta guar,' lOl, New-street ...• ...... ....... . , , , 4(l— Glasgow. °Mee, 18, Elchange-squarc .. ••• • . . Greenock, „ Cathcart-square... ...... , . qc: 4'4 —ublin, ' Dumfries Iligh-strekt ~ 23. College-green.... .... •• • • Delft at I. Donegal-street . ..... • • • i Cork, Pembroke•street Queenstown,: The Quay . ........ •••• • • • • • ' 'EDWARD B. BRIGHT, Se, ? 2s. 6d . Is. Od, 4s. Od, ;ret ary VIAPPIN'S RAZOR. /,, Sold everywhere. Warranted geod by the tnakerS, JOSEPII I IN and BROTRERS, Queen's Cutlery Works, - shefleld ; and oorgate-street, City, Lutalon. APPIN'S SUPERIOR TABLE KNIVES, as made for the Crystal Palace, Sydenhsm handles cannot 1 3' become loose : the blades are all of ths very first quality, their own Sheffield manufacture. ' ll3- suopiled at their London 'Warehouse, 37, Moo rgate-strut, 44 c 1 . Queen's Cutlery Works, Sheffield. V l - I) RRSHOT CAMP.--KIT for the CRIMEA. „Yo u Will go, of course, in the first place, to Benjamin Edging- ,—.‘Ablishment, across London-bridge, where•you will choose a %,_ 4I2 QP ket.le, waterproof blanket, bedstead, Month 'n ,7 11 v 1 , before Sebastopol. Tents obe seen erected at the mann- Netf a '. 2, nuke -street, across London-bridge, or 32, Charing-cross. I 'uPPlied with every requisite. • etiN' g ts t xrr . ER G H OUGH d s e p li A v y er t a h n 2 o 9t ß h ORATION 4) , o ' f ign Seven; AT et j Al o r n t Len t at Eigh ' t o'c e lock. the nap., ; Seats and Platform, ls. May be e Offices of the London Temperance League, 337, Strand. 1 --- It. N tt Ort of SEVASTOPOL.--GREAT GLOBE. 461 y the uew Approaches and Siege Works arc placed on °f l - evastopol, including Inkerman, Balaklava, and the !, at the Great Globe, Leicester square. open from /Zlth oo ,_ Admission to the whole building, one shilling. Children 1 % IV-if-price. A large collection of Russlan Trophies from ati 1 0 '. KAHN'S ANATOMICAL MUSEUM I, -.kb-OPENED at 4, COVr NTRY- , MtEET, LEICESTER- ()Den (for Gentlemen only) daily from half-past 11 till 44,t^' - I °,l l 7 till 10. A NEW SERIES of LECTURES, by . Dr. 114, x ',„' ‘ 'lt•G.S., &amp;amp; c., at 12, 2, 4, and half-past 7in the e ventn a g r ._ tilti;::H IL Anew catalogue, conialning lectures ou the t I tre;:l 4 branches of Physiology by Dr. Kahn, illustrated price m b y Post . 6l. extra. 4lt A.V ESEND ST., h 4 ooti l PACKETS. th e i c e ta r P,aperlic at the l p a ie t r t s h as e Greenhithe and ath Purfleet permit FROM TERRACE 'TER, GRAVESEND. aFat DAYS. SUNDAYS, \,___. FROM TERRACE PIER, GRAVESEND. \ \._.: l :___VEsx DATE. SUNDAYS. etr :4. F 4 t 1 f: 5l Time C i „ - i: f.l -A a. n ..) . a . ''s* _I. s , - 8 Zi w (4 4 A a I ___ 1 ~--' , .• 1 tom Fenchnrch-street Station to all parts of Londo, If an hoar. wrIARF, BL&amp;amp;CKWALL, on the arrival of the fo Trains from the Fenehurch-street Station. Vte K 10 Winx Trains from the Fenehurch-street Station. _ t5.... 1% . E . !it DAYS. ... SUNDAYS. N; . , tt i g 41; i '., 0. I Fen- ti - ' 1 1'1&amp;#34;'. .s. . G .2 ti, church 5.2 T.., 1 0 g ...' * 1 'g Street, i 8 r, s . '.' A.. . 4 N _... I 4'i -- -- ll—— -- N , , • et. Foro Cahn. Set..on o • r i 'lla Gravesend end Loudon.. • • ...... 103. .. Is. 2 . 1 al'eaend and Blackwell or Woolwich Bd. .. Gs. 101 Q(:irevesend end Intermediate Piers.. , rlcKETB.—Twolve Months, 5:. Os.; Six Months, 37. Os. ; 4 1 4 , 4,0 rith5, 21. Os. • to be had of the Collectors on board the •ti ov or of Mr. Monk, Terrace Pier, Gravesend. • 13 . 1854. Ita t SECRET INFIRMITIES OF YOUTH AND MATURITY. t O price 25., illustrated with cases ; free by post for 30 N., R , stamps, t 8 V 0.17 S DEBILITY; Ota ni Causes, Symptoms, and. Cure.—An Essay on Sper- a4,'%R.%ea, with Practical Observations on a safer and more if . kta, a . mode of treatment of the diseases of the Generative tr Obtained by the use of the Microscope in detecting and iY, 4l4l ing, by urinary examination, the real (Anse and efect of cariety of complaint, whether arising from solitary habits, t w r , accident, or climate, followed by practical remarks, founded l4 Vo ri t Y years' experience in the treatment of Impuissance, t ' a t kie Debility, Local Weakness, Spermatorrhosa, &amp;amp;c. which Commentaries on the Physiology of Marriage, with pre- hints on the evils emanating from empirical practice, t htt:a th e dangerous remedies advocated by various writers on ''portent disorders. a_ B7 By SAMUEL LA'3I.II2T, M.D. t,: mEDFORD-SQUARE, LONDON, t, Qr of Medicine, Matriculated Member of the 'Culvert ty of Edirt• 1.4 f, Honorary Member of the London Hospital Medical Society, 1 :11 a , 14 •Iate of Apethecaries' Hall, London, etc., fee. :qtl aa sential object 01 this treatise is to point out the fearful con- reeultbag from certain habits, irregularitiee, and excesses, have • procured more misery in Youth, degradation in Man- t.usr Premature decay at all stages of Life, than, perhape, any • 481 of disease known to modern pathologists. Its perusal is tll,4t,,al,arly recommended to persons entertaining secret doubts of 4,:i W sical condition, and who are conscious of having hazarded. -4 in a l • l, , happiness, and privileges to which every human being is i lt% • a,,,i m absolutely necessary that'll man should know, that the re are 111 Of personal management which cannot be violated without ,g grievous penalties, and when wisdom and regret succeed ‘,. 4 3 , 1;4 1 , a ' it 3'. of inconsiderate self-indulgence, how these ponaltios t' , 445;ated, how the sting of their bitterness may bo removed, ~ the evil end its conaequenees may be avoided, and ahovo 'ibra,:;7e le a:lamely any dearee of physical infirmity ar functional Lea' t ' i '.&amp;#34; - 'ent to which the timely all a science cannot apply a cure. fori, ! etaqleor has for a series of years been engaged in au exteneive the treatment of these delicate complaints, which have s Tai aately teen - too generally confided to the care of ignorant t lith i . r , c '•who inflict great injury on those who are induced to place •Nl , l rans. r ettl t ..: ° Uti -Prete DEBIL io ITY may be had, price 2s, of Messrs. Piper, aad 3 Patcraoater-row; Hannay, 63, Oxford-street ; e, 10 L C • t•s st • e.cester-satiare; Mann, 39, Cornhill; or free by post for ' 4 6-t a ,.. 4 ' Ps to any address from the Author's retie ice, 31, Bed- At t ' ar e• k h ome f till Vat, f or a consultation daily from Eleven till Type, Ind from</td>
<td style="text-align: left;">newspapers//0002194/1855/0328/0002194_18550328_mets.xml</td>
<td style="text-align: left;">advertisement</td>
</tr>
<tr class="even">
<td style="text-align: left;">newspapers//0002194/1855/1228/0002194_18551228.csv</td>
<td style="text-align: right;">126</td>
<td style="text-align: left;">THE ROTAL PICTURES AT OSBORNE. THE ART JOURNAL for JANUARY, 1856, price 2s. Gd., contains :—&amp;#34;L'Allegro,&amp;#34; from the Picture by W. E. Frost, A.R.A. ; Bay of after W. Callow ; and Gibson's Ba•+-relief of Cupid and in the possession of the Queen. The principal literary contents Artists' by F. W. Fairholt; by R. hunt, F.R.S, ; A Few Words on Beauty Soirée at the Pavilion at Brighton The Art Publications of M. M. Goupil British Artists—No. It , S;r A. W. Calcott, R. A illustrated ; Suggestions of Subject to the Student In Art The Country of by F. W. Fairholt, illustrated ; The Architectural &amp;amp;c., &amp;amp;c. Now Ready, price It. I Is. 6d., cloth gilt, the Vo:utne for 1855, being the first of the series containing the QUEEN'S PICTURES. Virtue and Co., 25 Paternoster-row, London ; and alt booksellers. The Third Eiltion.—Just published, price 155., by post, tree, ss. Cc. N TRUE &amp;amp; FALSE SPERMATORRREA, with the View of distinguishing the Imaginary from the Real Sufferers under this disease, and Correcting of wide-spread Errors in relation to their Treatment and Cure. From the German of Dr. PICKFORD. With an lntroluction by the Editor, containing a complete exposure of the system of terrorism and extortion pursued by the advertising quacks of the metropolis towards those who are credulous enough to seek their aid. Pickford 4 .8 known to English readers by his frequent practi- cal contributions to German medical literature. This is the first Vine, he informs ns, that ho has addressed himself to the non-medi- c:al reader. We trust this may not be the last, if be shall detect any other equally flagrant evil which it may be In his plwer to cor- Medical Gazette. The tribe of Quiet sympathl3ers,' and 'Medical Friends,' are mercilessly exposed; and if this bock could find its way Into the hands of those who stiffer from the com- plaint of which it treats, wo are satisfied that many hundreds would be saved much needless suffering of body and mind, and what is of less importance, though it is that which the quacks most prize—- much money...... This volume is well qualified to put an end to tin empirical system of treating Spermatorrhcea, and to place the treat- ment upon a more rational and physiological basis. It is, therefore, likely to do much London: IL Ralliere, '219, Regent-street. EVENING CLASSES.-CROSBY HALL, 32, Bishopsgate-street Within. —LENT TERM will com- mence on WEDNESDAY, Jan. 2d. The fee for each class is 3s. per term. A subscription of 14s. per year, or 4s. per quarter, entitles the subs •riber t ) the use of the Reading Room and Library at Crosby Hell, and also to attend any ono Class each term. Prospectuses, with lists of olasses, &amp;amp;.c. , mad• be had at the Library. MACKENZIE, A.M., lion. Soc. Spirit of the Public Journals. (From the Times of this day.) The fall of Kars has had, at any rate, this good result,—that it has at last drawn public attention to the theatre of those operations to which it has succumbed, and taught us the importance attached by a vigilant and skilful enemy, thoroughly ac- quainted both with the ground and the people, to a remote position, with which the British public has scarcely cared to make itself acquainted. No- body can doubt the vast importance attached by the Czar to the preservation of Sebastopol and of the fleet which sleeps beneath the waters of its har- bour. The unceasing exertions and dreadful sacri- fices of Russia attest it only too well. To save the place was the point of honour of the empire—the one object, compared with which all others seemed puny and insignificant. Yet, even in this crisis of his destiny, the Emperor of Russia could despatzli probably his best General and an army whose bravery is only too well attested by its enormous and almost incredible losses on the 29th of Septem- ber, not to defend his own frontier, but make a hostile inroad into the Turkish territory, and to possess himself of a city situated in a mountainous region and exposed to an inclement climate. So eager was Mouravieff for the prize, and so deter- mined to win at all costs, that se soon as lie heard of the fall of Sebastopol, attributing to the allied Generals a degree of foresight and activity which they were very far indeed from possessing, ho deemed it necessary to anticipate, at whatever cost, the expedition they wore sure to make, and so sustained a repulse which cost him a third of his army. Had ho known the easy and comfortable tactics of the allies ho might have saved his even, and taken the city just as well ; but it would be ungracious to blame an enemy for thinking bettor of us than we deserve. What now presses for consideration is whether we are tamely to sit down with this loss ; whether that which the Russian General has gained through our negligence he is to be allowed to keep through our supineness and want of enterprise. If we are ■ot to have peace we must seek out some vulner- able point in which we may strike Russia between the joints of her armour,—some place in which a victory may give us something more than a barren triumph, and draw after it other results than inter- minable catalogues of killed and wounded. While Sebastopol was untaken we considered it so indis- putably the first object of the war that we were well satisfied to sacrifice everything else to its at- tainment. The struggle was so gigantic, our in- terests and our honour were so obviously at stake, that no success, however great, could compensate us for any delay or any failure there. But, Sebas- topol once taken, a campaign in the Crimea has no other object than the capture or destruction of the Russian troops encamped within the penin- sula. The Crimea itself, except as a battle-ground, is utterly worthless, and we are only justified in remaining there on the supposition that there we can inflict more serious wounds on Russia than elsewhere. Whether this be so or not we cannot judge. Unless the coming campaign is to open with a spirit and a brilliancy very different from the close of its predecessor, 200,000 men could not be more entirely thrown away than in occupying the plateau between Kamiesh and Balaklava. Of this, at any rate, we may feel confident—that an expeditionary army can well be spared to-coperate with Omer Pasha in the Transcaucasian provinces, and to redeem the fallen honour of the allies in the estimation of the semi-civilised Courts of Asia. We are making war as mach against Russian pres- tige as Russian power, and cannot afford to allow her, by easy Asiatic successes, to obliterate the effect of European defeats inflicted upon her at so tremendous a cost. We know not what other field is left for our enterprise. To march into the deso- late interior would bo to follow the steps of Charles XII. and Sweden to certain destruction. The capture of Nicolaieff may hardly repay its cost while we hold the narrow passage through which alone the ships built at its dockyards can find their way into the sea ; but in the rich and beau- tiful valley that lies between the opposing ranges of the Caucasus and Ararat, with its glittering streams, its emerald meadows, its waving beech woods, its snow-capped mountains, we have a land peculiarly adapted for the operations of an Euro- pean force. In the north towards the Kouban are Mussulman tribes who, it is supposed, would fly to arms if a Turkish division were sent among them, and the banks of the Phasis and the Cyrus are inhabited by races ivh o would gladly welcome and heartily sup- port a Christian deliverer. To cut off the garrison , of Kars from all communication with Russia, to close the passes of the Caucasus, to scale the ascent which leads to the tableland of Georgia, to drive the Russians before us through Teflis to the very shores of the Caspian Sea, are enterprises the re- sults of which would be enormous, but the difficulty of which would bs by no means so great as those over which we have already triumphed. Resting on our fleet and a friendly population as a secure basis of operations, it would be easy for the allies to wrest from the hands of the Russians the com- mand of the Caspian Sea, and to restore to Persia that of which Russia has deprived her—the right of navigating what must in all fairness be considered her waters. Either we must be prepared to enter on some such enterprise as this, or to leave the Emperor in possession of his present conquests, and in a condition to push them further so soon as he shall be relieved from the vast concentration of his forces which the contest for the possession of Sebas- topol had rendered necessary. The affairs of Asia cannot be left as they are ; there, and there alone, Russia is still able to assume the offensive, and will infallibly attain more, unless we take away from her that which she now has. Lot it not be supposed that in suggesting a cam- paign in the Transcaucasian provinces we are , actuated by any desire meanly and selfishly to employ the power of France to carry out merely English objects ; we repeat what we have so often said—that we have no fear whatever from Russia for our Indian empire. Nothing that she has done in this war raises our opinion of her as an aggressive Power, and in India she would be en- countered by a combination of obstacles far more formidable than any which she has hitherto been called upon to surmount. We have no wish to in- volve ourselves in the maze of Central Asian in- trigues. We have no wish for any increase of territory to the north of the Himalayas. All our objects would be strictly common to us with our ally. We wish to strike Russia in the most vul- nerable point. We wish to oppose to her future aggression the rugged barrier of the Caucasus and the still more rugged valour of its tribes. We wish to prevent her from practising upon Persia those arts and those menaces which so nearly suc- ceeded against Turkey. We are no more disposed to tolerate her presence at Teheran than at Con• stantinople or Hammerfest. We would not allow Russia to turn the left flank of Turkey by the Balkan—we must not permit her to turn the right, which now lies open to her by way of the valleys of the Tigris and the Euphrates. We have stopped her external commerce ; it is time wo applie d a tourniquet to he r main artery,—the vast flood of the Volga. Th ese thi ngs mus t be done, not in the interest of England alone, but in that of the world. A solid peace can only be founded on the conviction of the power of the Allies, and that conviction will then be most surely pro d uc ed when we employ our strength at those points, not where our enesty is most, but where he is least, prepared to receive us. The Pkare de la Manche announces that 30,000 or 40,000 men will probably be encamped this winter i❑ the neighbourhood of Cherbourg for the purpose of being embarked next spring for the Russian Baltic pro- vinces. The establishment of another camp of 20,000 men, near Brest, is &amp;amp;aa talked of.</td>
<td style="text-align: left;">newspapers//0002194/1855/1228/0002194_18551228_mets.xml</td>
<td style="text-align: left;">advertisement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">newspapers//0002194/1855/0529/0002194_18550529.csv</td>
<td style="text-align: right;">67</td>
<td style="text-align: left;">WOODIN'S ENTERTAINMENT. Mr. Woodin, already so favourably known to the public by his and at the Regent-street Gallery, has st‘rted a fresh concern' in King William-street, Strand. This new entertain. ment he has named Woodin's Olio of It takes a more ambitious range than Mr. Woodin's pre. vious performances. It comprises an entirely new corals entertainment, and a moving panorama of the romantio lake scenery of England. This new speculation of Mr. Woodin's is a decided and one that seems to be highly appreciated by the public.</td>
<td style="text-align: left;">newspapers//0002194/1855/0529/0002194_18550529_mets.xml</td>
<td style="text-align: left;">advertisement</td>
</tr>
<tr class="even">
<td style="text-align: left;">newspapers//0002194/1855/1023/0002194_18551023.csv</td>
<td style="text-align: right;">106</td>
<td style="text-align: left;">No. 19,675.] PUBLICATIONS. NOTICE.—MR. PRESCOTT'S NEW WORK, HISTORY of the REIGN of PHILIP 11. of SPAIN, will be publishel by Mr. Bentley, New Burlington- street, Immediately, in 2 vols. Bvo. MISS SINCLAIR'S NEW NOVEL, CROSS PURPOSES, will be publish,cl on Friday next, October 26, in 3 vols., by Mr. Bentley, New Burlington-street. SCOTTISH WIDOW'S' FUND AND LIFE ASSURANCE SOCIETY. Founded A.D. 1815. Upoa the Principles of purely Mutual Assurance. The INVESTED FUND or CAPITAL arising from the accumu- lation of Premiums, and which belongs exclusively to the Assured, now exceeds TWO MILLIONS EIGHT HUNDRED THOUSAND POUNDS STERLING. During the last seventeen years alone, Assurances have been effected with the Office to the amount of more than EIGHT MIL- LIONS SIX HUNDRED THOUS AND POUNDS, being. on an average, upwards of 11-I.LP A MILLION STERLING in each year ; and notwithstanding the slatya competition among the nume- rous Life Assurance Institutions existing and constantly springing up, and the great inducements, in the shape of comm ssion. offered by many of them for the introducti , t) of business, the Society have obtained the large and steady business above indicated, without to my extent altering their practice of allowing remuneration, at a fait and reasonable rate, to the Lccal Agents only, —no Commission being offered or given to third patties. The representatives of varh us Original Members of the Society who have died within the last few years, have received In no”us Addtions more than the Sams originally assured by the respective Policies. Forms of Proposal, Prospectuses, and all necessary information, rnay be had on application at the Head Office, or at any of the various Agencies in the three Kingdoms. JOHN MACKENZIE, Manager. WM. LI N DE S AY, Secretary. HEAD OFFlca—Edinburgh, 5, St. Andrew-square, 29th September, 1855. LONDON HONORARY BOARD. George Young, Esq., Mark-lane Charles Edward Pollock, F,sq., Barrister, Temple David Hill, Esq., East India House John Murray, Esq., publisher, Albemarle-street Samuel Laing, Esq., Chairman of Brighton Railway Sir John Thomas Brings. Admiralty Leonard Horner, Esq., Home-office John Taylor, jun., Esq., C.E., Queen-street -place LONDON AND THE SUBTODS. CENTRAL AGENT. Hugh M'Kean, 4, Royal Exchange-buildings, Cornhill. DISTRICT AGENTS. Captain R. R. Ridge, 49, Pall-mall, Agent for the West End Distric Benton Seeley, 2, Hanover-street, Regent-street AGENT FOE KNIGHTSBRIDGE AND PIMLICO DISTRICT. James Harris, Estate Agent, 29, Lower Beigrave-street, Eaton• square.</td>
<td style="text-align: left;">newspapers//0002194/1855/1023/0002194_18551023_mets.xml</td>
<td style="text-align: left;">advertisement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">newspapers//0002194/1855/0501/0002194_18550501.csv</td>
<td style="text-align: right;">181</td>
<td style="text-align: left;">THE,A.I RE ituY AL ILAYMA.BahT. It of Mr. Backstone. THIS EVENING, Will be performed THE BOHEMIAN GIRL. Characters by Me , sr4 Sims Reeves, Weiss, Manvers, and Farquharson; Miss H. Gordon, and Mrs. Sims Reeves. After which, a now Extravaganza, called THE NEW HAT MARKET SPRING MEETING, 1835. To conclude with POPPING THE QUESTION. ROYAL PRINCESS'S THEATRE, OXFORD-STREET. under the Management of Mr. Ca.taiss THIS EVENING, Will be performed LIVING TOO FAST. To be followed by FAUST AND MARGUERITE. princip al characters by Messrs. C. Kean, D. Fisher, Raymond, Cathcart, and Saker ; Mrs. Wlnstan'ey, Misses C. Leciercq, Daly, and K. Terry. To conclude with (16th time) a Romance, in two acts, entitled THE MULETEER OF TOLEDO ; or, King, Queen, and Knave. TILEATRE ROYAL ADELPIII. Proprieta, Mr. B. Webster.—Directress, Madame Celeste. THIS EVENING, WU be performed KING O' NEIL, Characters by Mess - e. C, Selby, Garden, Parse' . e, J. Bland, L. Murray, &amp;amp;c,; Mrs. L. Mur- ray, Miss Wyndham, Ste. To conclude with A NEW EDITION OF VIE FAIRY TALES Or MOTHER GOOSE, with numerous highly-coloured Illustrations. ROYAL OLYMPIC THEATRE. Lessee and Manager, Mr. A. Wigan. THIS EVENING, Nrod be performed TUE WEL9II IRE:. Characters by 3f, ears. Emery, Leslie, and Danvers ; lldiss Stephens, arid Miss Ternan. After which, the Comedietta, called LAW FOR L ADIESI. Cha- racters by Messrs. A. Wigan, G. Yining, H. Cooper, Danvers, and Miss Castleton. To be followed by the Fairy Extravaganza, called TAE YELLOW DWARF AND THE KING OF IHE GOL..) MINES. ROYAL STRAND THEATRE. Under the direction of Miss Rebecca Isaacs. THIS EVENING, Will be performed Donizetti's Opera of THE DAUGHTER OF THE REGIMENT. After which, KING QUEER AND HIS DAUGHTERS THREE. To conclude with THE WATERMAN'. ASTLEY'S ROYAL AMPHITHEATRE. Lessee and Manager, Mr. Wm. Cooke. First night of a Grand Hibernian Ballet THIS EVENING. The Interesting Equestrian Drama by Nelson Lee, called, THE FIELD AGAINST THE FAVOURITE ! After which, the SCENES in the CIRCLE, including Mr. W. Cooke's Dwarf Elephants. To conclude with, first time, a Grand Ballet, by Mrs. G. Healey, Called, THE LAKES OF KILLARNEY. A new Military Act Drop, painted by Fenton, has been added to the Embellishments. Box-office open from Eleven till Four. =Stage Manager, Mr. W. West. Acting Manager. Mr. W. H. Cooke. Equestrian Director, Mr. W. Cooke. Jun.</td>
<td style="text-align: left;">newspapers//0002194/1855/0501/0002194_18550501_mets.xml</td>
<td style="text-align: left;">article</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="set-up-the-machine-learning-model" class="level2">
<h2 class="anchored" data-anchor-id="set-up-the-machine-learning-model">Set up the Machine Learning Model</h2>
<p>In this step, we begin preparing the data for machine learning. We set a seed for reproducibility to ensure consistent results when randomization is involved. The target variable ‘type’ in the advertisements data is converted to a factor as it represents categorical classes (‘advertisement’ and ‘article’).</p>
<p>The data is then split into training and testing sets using the <code>initial_split</code> function. This separation is crucial for evaluating the performance of the machine learning model and preventing overfitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9999</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>advertisements_labelled <span class="ot">=</span> advertisements_labelled <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>advertisements_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(advertisements_labelled, <span class="at">strata =</span> type)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>advertisements_train <span class="ot">&lt;-</span> <span class="fu">training</span>(advertisements_split)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>advertisements_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(advertisements_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-recipe-for-text-data" class="level2">
<h2 class="anchored" data-anchor-id="create-recipe-for-text-data">Create Recipe for Text Data</h2>
<p>To prepare the text data for modeling, we create a recipe using the <code>recipe</code> function. The <code>textrecipes</code> package provides essential tools for text preprocessing and feature extraction in machine learning. In this recipe, we tokenize the text, remove stop words, and apply a term frequency transformation to represent the text data as numerical features. These transformations convert the raw text data into a format suitable for machine learning algorithms, enabling them to process and understand textual information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>advertisement_rec <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(type <span class="sc">~</span> text, <span class="at">data =</span> advertisements_train)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>advertisement_rec <span class="ot">&lt;-</span> advertisement_rec <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(text, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span> <span class="dv">1000</span>, <span class="at">min_times =</span> <span class="dv">5</span> )  <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tf</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we set up a <code>workflow()</code> object, which will store the recipe and later the model instructions, and make it easier to reuse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>advertisement_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(advertisement_rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the model. In this case, we’ll use a random forest model, from the package <code>ranger</code>. Setting the <code>importance = "impurity"</code> parameter means we’ll be able to see what words the model used to make its decisions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>rf_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Model Specification (classification)

Engine-Specific Arguments:
  importance = impurity

Computational engine: ranger </code></pre>
</div>
</div>
<p>Take the workflow object we made above, and add the model to it. After this, use <code>fit</code> to run the model, specifying it should use the <code>advertisements_train</code> dataset we created above.</p>
<p>Finally, we use <code>predict</code> on this fitted model, specifying <code>advertisements_test</code> as the dataset. Add the true labels from <code>advertisements_test</code> as a new column, and use <code>accuracy()</code> to compare the true label with the prediction to get an accuracy score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a> advertisement_wf <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> advertisements_train)<span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> advertisements_test) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">truth =</span> advertisements_test<span class="sc">$</span>type) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(truth, .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.811</code></pre>
</div>
</div>
</section>
<section id="perform-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="perform-cross-validation">Perform Cross-Validation</h2>
<p>To evaluate the model further, we’ll use cross-validation. Cross-validation is a crucial step in model evaluation. It helps assess the model’s generalization performance on unseen data and reduces the risk of overfitting.</p>
<p>In this step, we set up cross-validation folds using the <code>vfold_cv</code> function, which creates multiple training and testing sets from the training data. The model will be trained and evaluated on each fold separately, providing a more robust estimate of its performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>advertisements_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(advertisements_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-the-random-forest-model-with-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="train-the-random-forest-model-with-cross-validation">Train the Random Forest Model with Cross-Validation</h2>
<p>Now, we train the Random Forest model using cross-validation. The <code>fit_resamples</code> function fits the model to each fold created during cross-validation, allowing us to evaluate its performance across different subsets of the training data. The <code>control_resamples</code> function is used to control various settings during the resampling process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rf_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(advertisement_rec) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>rf_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
3 Recipe Steps

• step_tokenize()
• step_tokenfilter()
• step_tf()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (classification)

Engine-Specific Arguments:
  importance = impurity

Computational engine: ranger </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rf_rs <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  rf_wf,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  advertisements_folds,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate-the-models-performance" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-the-models-performance">Evaluate the Model’s Performance</h2>
<p>In this step, we collect the evaluation metrics and predictions from the cross-validation process. The collected metrics will help us assess the model’s performance, while the predictions on each fold will be used for further analysis and comparison. By evaluating the model on multiple subsets of the data, we can gain insights into its robustness and reliability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rf_rs_metrics <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(rf_rs)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rf_rs_predictions <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(rf_rs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-the-confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-confusion-matrix">Visualize the Confusion Matrix</h2>
<p>The confusion matrix is a useful visualization for evaluating the performance of a classification model. It shows the number of true positives, true negatives, false positives, and false negatives. The <code>autoplot</code> function from the <code>yardstick</code> package allows us to visualize the confusion matrix as a heatmap. This visualization aids in understanding the model’s classification accuracy and any potential misclassifications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat_resampled</span>(rf_rs, <span class="at">tidy =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that there are very few true advertisements which are misclassified as articles - but there are some some articles misclassified as advertisements.</p>
</section>
<section id="tune-the-random-forest-model" class="level2">
<h2 class="anchored" data-anchor-id="tune-the-random-forest-model">Tune the Random Forest Model</h2>
<p>In machine learning, hyperparameter tuning is essential for optimizing model performance. In this step, we define a tuning grid using the <code>rand_forest</code> function. The grid specifies different combinations of hyperparameters, such as the number of variables randomly sampled for splitting (<code>mtry</code>) and the minimum number of samples per leaf node (<code>min_n</code>). We aim to find the best combination of hyperparameters that yields the highest performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">1000</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="fu">tune</span>()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tune_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(advertisement_rec) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tune_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tune-the-random-forest-model-with-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="tune-the-random-forest-model-with-cross-validation">Tune the Random Forest Model with Cross-Validation</h2>
<p>Now, we perform hyperparameter tuning using cross-validation. The <code>tune_grid</code> function uses the tuning grid specified earlier and fits the model on each fold of the data to identify the optimal hyperparameters. This process helps us identify the best hyperparameters for the Random Forest model, leading to improved performance and better generalization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">555</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>trees_folds <span class="ot">=</span> <span class="fu">vfold_cv</span>(advertisements_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">=</span> <span class="fu">tune_grid</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  tune_wf,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> trees_folds,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> <span class="dv">20</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>i Creating pre-processing data to finalize unknown parameter: mtry</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tune_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Tuning results
# 10-fold cross-validation 
# A tibble: 10 × 4
   splits          id     .metrics          .notes          
   &lt;list&gt;          &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
 1 &lt;split [95/11]&gt; Fold01 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 2 &lt;split [95/11]&gt; Fold02 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 3 &lt;split [95/11]&gt; Fold03 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 4 &lt;split [95/11]&gt; Fold04 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 5 &lt;split [95/11]&gt; Fold05 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 6 &lt;split [95/11]&gt; Fold06 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 7 &lt;split [96/10]&gt; Fold07 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 8 &lt;split [96/10]&gt; Fold08 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
 9 &lt;split [96/10]&gt; Fold09 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
10 &lt;split [96/10]&gt; Fold10 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;</code></pre>
</div>
</div>
</section>
<section id="visualize-the-tuning-results" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-tuning-results">Visualize the Tuning Results</h2>
<p>To visualize the tuning results, we plot the average Area Under the Receiver Operating Characteristic Curve (ROC AUC) against different values of <code>mtry</code> and <code>min_n</code>. ROC AUC is a common metric for assessing the model’s ability to discriminate between classes. The plot provides insights into how different hyperparameter values affect the model’s performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tune_res <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"roc_auc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mean, min_n, mtry) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(min_n<span class="sc">:</span>mtry,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"parameter"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value, mean, <span class="at">color =</span> parameter)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"AUC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s a little difficult to interpret, but it looks like the highest values are between about 40 and 250 for the <code>mtry</code> value, and around 10 and 30 for the <code>min_n</code> value. We can do another grid search, this time just looking between these values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rf_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">250</span>)),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>)),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>regular_res <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  tune_wf,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> trees_folds,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> rf_grid</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>regular_res <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"roc_auc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_n =</span> <span class="fu">factor</span>(min_n)) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mtry, mean, <span class="at">color =</span> min_n)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"AUC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>best_auc <span class="ot">&lt;-</span> <span class="fu">select_best</span>(regular_res, <span class="st">"roc_auc"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>final_rf <span class="ot">&lt;-</span> <span class="fu">finalize_model</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  tune_spec,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  best_auc</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly, evaluate the accuracy using the same method as before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>advertisement_wf <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(final_rf) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> advertisements_train)<span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> advertisements_test) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">truth =</span> advertisements_test<span class="sc">$</span>type) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(truth, .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.865</code></pre>
</div>
</div>
<p>As you can see, we have improved the model’s performance, from about .80 to about .86. There are other ways you could try to improve the performance further. With text, the pre-processing steps can often make a huge difference. You could experiment with the text ‘recipe’, for instance adjusting <code>step_tokenfilter</code> to include or remove more tokens. You could also use <code>step_word_embeddings</code>, using the output of the word embeddings in <a href="word2vec.html">Chapter&nbsp;<span>12</span></a>.</p>
</section>
<section id="build-the-final-random-forest-model" class="level2">
<h2 class="anchored" data-anchor-id="build-the-final-random-forest-model">Build the Final Random Forest Model</h2>
<p>In this step, we build the final Random Forest model using the best hyperparameters obtained from tuning. The model is then fitted on the entire training dataset to capture the relationships between features and target classes optimally. This final model is the one that we will use for making predictions on new data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>final_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(advertisement_rec) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(final_rf)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>final_res <span class="ot">&lt;-</span> final_wf <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(advertisements_split)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>final_res <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric  .estimator .estimate .config             
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary         0.865 Preprocessor1_Model1
2 roc_auc  binary         0.888 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section id="what-features-is-the-model-using" class="level2">
<h2 class="anchored" data-anchor-id="what-features-is-the-model-using">What features is the model using?</h2>
<p>To understand how the model is using the text to make decisions, we can look at the most important features (in this case, text frequency counts) used by the random forest algorithm. We’ll use the package <code>vip</code> to extract the most important features, using the function <code>extract_fit_parsnip()</code>, and plotting it using <code>ggplot2</code>.</p>
<p>For the random forest method, we can only see the overall top features, and not which were more important for the prediction of the different categories. The most important feature is the frequency of the word ‘street’: at a guess, this is used more often in advertisements, which very often contain an address to a business or service. Interestingly, the second most important feature is the word ‘was’. Is this perhaps because news articles are more likely to use the past tense than advertisements? Interestingly, the frequency of certain function words such as <code>the</code>, <code>and</code>, <code>to</code>, <code>of</code> (which would often be filtered out as ‘stop words’) also seems to be important to the model. One explanation is that the use of these words is quite different in prose and in the kind of text used in advertisements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>complaints_imp <span class="ot">&lt;-</span> <span class="fu">extract_fit_parsnip</span>(final_res<span class="sc">$</span>.workflow[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vi</span>(<span class="at">lambda =</span> choose_acc<span class="sc">$</span>penalty)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>complaints_imp <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Variable =</span> <span class="fu">str_remove</span>(Variable, <span class="st">"tfidf_text_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable,Importance), <span class="at">y=</span> Importance)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="using-the-model" class="level2">
<h2 class="anchored" data-anchor-id="using-the-model">Using the Model</h2>
<p>Once we are happy with the final model, we can use it to label unseen data as either articles or advertisements. For this, we’ll need a newspaper corpus. As in previous chapters, either construct your own corpus by following <a href="download-and-unzip.html">Chapter&nbsp;<span>8</span></a> and <a href="extract-text.html">Chapter&nbsp;<span>9</span></a>, or <a href="https://doi.org/10.5281/zenodo.8262355">download</a> and open the ready-made .zip file with all issues from 1855. Next, get these articles into the correct format. See <a href="term-freq.html">Chapter&nbsp;<span>10</span></a> for an explanation of this code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>news_sample_dataframe <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"newspaper_text/"</span>, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">pattern =</span> <span class="st">"csv"</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">recursive =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>all_files <span class="ot">=</span> <span class="fu">lapply</span>(news_sample_dataframe, data.table<span class="sc">::</span>fread) </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(all_files) <span class="ot">=</span> news_sample_dataframe</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>all_files_df <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(all_files, <span class="at">idcol =</span> <span class="st">'filename'</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>title_names_df <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">newspaper_id =</span> <span class="fu">c</span>(<span class="st">'0002090'</span>, <span class="st">'0002194'</span>, <span class="st">'0002244'</span>, <span class="st">'0002642'</span>, <span class="st">'0002645'</span>, <span class="st">'0003089'</span>, <span class="st">'0002977'</span>), <span class="at">newspaper_title =</span> <span class="fu">c</span>(<span class="st">'The Liverpool Standard And General Commercial Advertiser'</span>, <span class="st">'The Sun'</span>, <span class="st">'Colored News'</span>, <span class="st">'The Express'</span>, <span class="st">'The Press'</span>, <span class="st">'Glasgow Courier'</span>, <span class="st">'Swansea and Glamorgan Herald'</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>news_df <span class="ot">=</span> all_files_df <span class="sc">%&gt;%</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">filename =</span> <span class="fu">basename</span>(filename))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>news_df <span class="ot">=</span> news_df <span class="sc">%&gt;%</span> </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(filename, </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'newspaper_id'</span>, <span class="st">'date'</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> <span class="co"># separate the filename into two columns</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_remove</span>(date, <span class="st">"</span><span class="sc">\\</span><span class="st">.csv"</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove .csv from the new data column</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(newspaper_id, date, art, text) <span class="sc">%&gt;%</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date)) <span class="sc">%&gt;%</span> <span class="co"># turn the date column into date format</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">article_code =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># give every article a unique code</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(article_code, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> <span class="co"># select all columns but with the article code first </span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(title_names_df, <span class="at">by =</span> <span class="st">'newspaper_id'</span>) <span class="co"># join the titles </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-predictions-on-newspaper-articles" class="level2">
<h2 class="anchored" data-anchor-id="make-predictions-on-newspaper-articles">Make Predictions on Newspaper Articles</h2>
<p>With the final Random Forest model trained, we proceed to make predictions on the newspaper articles’ text data. This involves applying the text preprocessing steps (e.g., tokenization, TF-IDF) used during training to transform the new data into the same format. The model then predicts whether each article is an advertisement or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>new_ads_to_check <span class="ot">=</span> final_wf <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> advertisements_train)<span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> news_df)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>all_files_df <span class="ot">=</span> all_files_df <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prediction =</span>new_ads_to_check<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyze-the-top-words-in-advertisements" class="level2">
<h2 class="anchored" data-anchor-id="analyze-the-top-words-in-advertisements">Analyze the Top Words in Advertisements</h2>
<p>After making predictions, we perform text analysis to identify the top words associated with advertisements. We tokenize the text data, count the occurrences of each word for each prediction, and select the most frequent words in advertisements. This analysis allows us to gain insights into the language patterns characteristic of advertisements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">'stop_words'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>all_files_df <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, <span class="st">"[0-9]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words) <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(prediction, word) <span class="sc">%&gt;%</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prediction) <span class="sc">%&gt;%</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> n, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> <span class="fu">as.factor</span>(prediction),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">word =</span> <span class="fu">reorder_within</span>(word, n, prediction)) <span class="sc">%&gt;%</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="fu">aes</span>(word, n)) <span class="sc">+</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>prediction, <span class="at">scales =</span> <span class="st">'free'</span>) <span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reordered</span>()<span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Advertisements often contain an address, including the word ‘street’, unlike articles. This matches the findings from the top features, above. Advertisements also often specify an exact time and date, resulting in higher counts of the word ‘o’clock’.</p>
</section>
<section id="analyze-the-proportion-of-advertisements-in-each-newspaper-issue" class="level2">
<h2 class="anchored" data-anchor-id="analyze-the-proportion-of-advertisements-in-each-newspaper-issue">Analyze the Proportion of Advertisements in Each Newspaper Issue</h2>
<p>Finally, we analyze the proportion of advertisements in each newspaper issue. We group the articles by their <code>newspaper_id</code> and <code>date</code>, calculate the proportion of advertisements in each issue, and then compute the mean proportion for each newspaper. This analysis helps us understand the prevalence of advertisements in different newspapers over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>news_df<span class="sc">$</span>type <span class="ot">=</span> new_ads_to_check<span class="sc">$</span>.pred_class</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>news_df <span class="ot">=</span>news_df  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">str_count</span>(text))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>news_df <span class="ot">=</span>news_df  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">issue_code =</span> <span class="fu">paste0</span>(newspaper_id, <span class="st">"_"</span>, date))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>news_df <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(newspaper_title, issue_code, type) <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(newspaper_title, type) <span class="sc">%&gt;%</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_prop =</span> <span class="fu">mean</span>(prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">str_trunc</span>(newspaper_title,<span class="dv">30</span>), <span class="at">y =</span> mean_prop, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'newspaper_title', 'issue_code'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'newspaper_title'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tidymodels_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interestingly, some of the regional titles (Liverpool, Glasgow, Swansea and Glamorgan) seem to have much higher proportions of advertisements - provided the labelling by the machine learning model is largely correct, of course.</p>
</section>
<section id="recommended-reading" class="level2">
<h2 class="anchored" data-anchor-id="recommended-reading">Recommended Reading</h2>
<p><a href="https://smltar.com/">Supervised Machine Learning for Text Analysis in R</a></p>
<p>Broersma, Marcel, and Frank Harbers. “Exploring Machine Learning to Study the Long-Term Transformation of News.” In <em>Journalism History and Digital Archives</em>, edited by Henrik Bødker, 1st ed., 38–52. Routledge, 2020. https://doi.org/10.4324/9781003098843-4.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./word2vec.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Word Embeddings</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./text-reuse.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Text Reuse</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>